version: '2'

services:
  ctfd_remote_llm:
    build: 
      context: ../
      dockerfile: dockerfiles/Dockerfile.dev
    user: root
    restart: always
    ports:
      - "8000:8000"
    volumes:
      - ../.data/ctfd_remote_llm/logs:/var/log/ctfd_remote_llm
      - ../models/:/opt/models/
      - ../:/opt/ctfd_remote_llm:ro
    env_file:
      - ../.env
    depends_on:
      cache:
        condition: service_healthy
    networks:
        default:
        internal:
    healthcheck:
      test: ["CMD", "curl","-f","http://localhost:8000/health"]
      start_period: 5s
      interval: 5s
      timeout: 5s
      retries: 55

  cache:
    image: redis:4
    restart: always
    volumes:
    - ../.data/redis:/data
    networks:
        internal:
    healthcheck:
      test: ["CMD", "redis-cli","ping"]
      start_period: 5s
      interval: 5s
      timeout: 5s
      retries: 55

networks:
    default:
    internal:
        internal: true